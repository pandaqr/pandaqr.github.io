---     
layout: post     
title:  "ipa重签名"     
date:   2015-08-23 03:05:00     
categories: IOS     
---     

缘由是朋友问我淘宝上买的「双开微信」是不是安全，我就去研究了下bundle改签名的原理。本来以为不就是改个签名嘛，想不到坑很大。     

#### 方法一：手动用`codesign`命令：     
这条命令是mac电脑默认自带的，格式如下：  

```     
codesign -fs "iPhone Distribution: Le Lu (99ZNA7BG5M)" --entitlements ~/Desktop/entitlements.plist ~/.../Pastebot1.4.2/Payload/Pastebot.app     
```     
这条命令可以覆盖原来的签名。     

「注意1」     
`iPhone Distribution: Le Lu (99ZNA7BG5M)`是证书的名字，可在钥匙串工具里面找到证书，然后看里面的`commom name`栏目     
「注意2」     
这里需要自己制作一个plist文件，命名为`entitlements.plist`，文本如下：    

```xml     
<?xml version="1.0" encoding="UTF-8"?>     
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">     
<plist version="1.0">     
<dict>     
	<key>application-identifier</key>     
	<string>SXY7J8MS3P.me.rocklule.test</string>        
	<key>com.apple.developer.team-identifier</key>     
	<string>SXY7J8MS3P</string>     
	<key>get-task-allow</key>     
	<false/>     
	<key>keychain-access-groups</key>     
	<array>     
		<string>SXY7J8MS3P.me.rocklule.test</string>     
	</array>     
</dict>     
</plist>     
```     

其中：`SXY7J8MS3P.me.rocklule.test`是需要改动的，前面的`SXY7J8MS3P`是开发者前缀，可以在钥匙串工具里的证书说明里面查到，后面是包名，注意所有这本的包名要一致。     
「坑1」：这个文件前面不可以有空格，有了就不行。     
「坑2」：网上这个文件版本有两种，另一种不好使。。。     

第二步是把`xx.mobileprovision`改名为`embedded.mobileprovision`放到app目录下。     
「坑1」名字不可改。     
「坑2」这个文件有不同的发布版本，`必须`是`app store`方式。     

完成后用zip命令打包：     
`zip -r xxxx.ipa SORCE_DIER`    

#### 方法二：用`iReSign`软件     
这个软件在github有链接，直接下载下来用就可以。会自动帮你提取证书的commom name，比较方便。     


#### 最大的坑     
必须要`企业证书`重签名的app才能安装，个人证书签完了闪退。。。     
