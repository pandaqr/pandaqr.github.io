---     
layout: post     
title:  "配置一台真正的服务器"     
date:   2015-02-05 13:12:00     
categories: Linux     
---     

由于需要准备和校外的朋友一起测试app，总需要一台公网服务器。与其去租用免费的公共服务器资源，我更乐意试试把实验室的电脑配置成一台服务器。     

思路很简单：     
1. 需要一个公网ip，学校的电信宽带可以提供，但是前提是有WiFi。     
2. ip需要固定，可以通过配置实现。     
3. 需要一台装有linux的电脑。     

但是实现却没想象那么简单：     

#### Ubuntu的双系统安装     
我还是需要保留windows的编译环境的，所以必须在不破坏原有win7的情况下安装双系统。恩，简单的，分区，然后制作ubuntu的启动u盘，重启，安装。。。     
然后让我选分区「挂载点」，好几个，然后是「系统引导分区」。。。懵了     
虽然Mac作为UNIX已经用了很久，但是真正的Linux还真是没装过。。。于是上网随便看了个教程     
哦，要把多个文件夹挂载到多个分区，ok！装好了！     
然后win7没了。。。。     

痛苦完以后，拿起「鸟哥」补基础，总结如下：     
##### 设备的命名     
对于SATA设备（包括USB），一般会挂载到`/dev`下，然后根据硬件被系统的加载顺序，按顺序分配sda,sdb,sdc....sdp，动态分配。而一个硬盘的分区，则是sda1,sda2,...按照数字分     

##### 分区表     
分区表位于硬盘的第一个扇区，大小是64字节。所以只能写4个分区项目，为了解决分区不够多的事情呢，把4个分区这样设定：3个可以做「主分区」（最多3个），另一个是「扩展分区」。这个扩展分区呢，可以再被分为多个「逻辑分区」，但是有如下限制：     
1. 扩展分区最多只有1个     
2. 逻辑分区的数量可以有很多，但是都必须是在扩展分区里面切切切     
3. 逻辑分区不能和主分区合并，否则需要重新对整个扩展分区进行格式化     
4. 逻辑分区的编号从5开始，1-4留给主分区     
所以呢，一般会把逻辑分区放到最后，否则要是主分区已经3个了，就不能再分区了。。。     

##### 启动项     
在第一个扇区内，除了分区表，还有重要的「主引导记录」（Master Boot Recoder），它主要是指向第一个分区的「引导加载程序」（loader）和后面分区的「引导记录」。相当于一个list。     
对于有操作系统的分区，或者有启动项的分区，第一个扇区必须写如引导记录，里面记录了loader。而开机的时候，默认只会读`第一个分区的第一个扇区`，就是如果MBR里面没有把后面分区加到list里面，那么就不会去读后面分区的引导记录了。。。     
于是就有了双系统，装了一个干掉一个的情况。新的系统一般只会去修改MBR，而不会把别人的引导记录加到list里面。于是我们要做的事情，就是把ubuntu的引导写入到`后面分区`的引导扇区中，而不是写到整个磁盘（MBR），然后，再进入win7，去把ubuntu的引导记录加入到MBR的list中，大功告成！     

----     

#### 公网ip的实现     
unbuntu装好之后，发现一件很囧的事情，无线网卡没有驱动了。。     
用的是360WiFi，查了一下似乎装驱动不容易，还是选择了在win里面装虚拟机。     
但是虚拟机的ip怎么和主机一样呢？     
答案是NAT，然后在虚拟机里面设置`端口映射`。顺便检验一下网络理论。     
在VMware workstation 11内，`编辑》虚拟网络编辑器》NAT模式的NAT设置`就可以找到选项     
把主机（网关）ip的80端口，全都映射到内网虚拟机ip的80端口，实现穿透。     
然后装上Apache测试，用手机访问主机的ip，显示虚拟机的Apache页面，it works！     

#### ubuntu系统ip的固定
修改`/etc/network/interface`文件
{% highlight java %}     
auto lo
iface lo inet loopback
 
auto eth0
iface eth0 inet static
address 192.168.xxx.xxx
netmask 255.255.255.0
network 192.168.xxx.0
broadcast 192.168.xxx.255
gateway 192.168.xxx.1
{% endhighlight %}     

修改`/etc/resolv.conf`文件

```
nameserver 202.xxx.xxx.xxx (your_DNS_server)
```

重启网络
`sudo /etc/init.d/networking restart`

[注]`nm-tool`可在ubuntu下查询网络信息，包括DNS

#### ubuntu的LAMP安装     
想不到与Mac上差别竟然挺大，不但启动命令不一样，连配置文件的名字都可以不一样。折腾了蛮久，这些配置文件真实太诡异了，经常改了几行就跑不起来了。     
MySQL的配置文件my.cnf令我印象深刻，仅仅是把这个文件的权限加到777，就可以让整个MySQL毫无征兆地跑不起来！！     
现在我改这种文件都吓得先cp一份了，一不小心就弄坏了。     

#### Mysql数据库的迁移     
这个数据库的迁移几乎是每次都有出问题，问题都在字符集。这次导入导出都是utf8，可是读到页面里面却变成了乱码，而新写入的数据又没问题。     
检查了很久，终于发现是PHP连接的时候没有强制指定utf8，各个操作系统差别真是不小！     

