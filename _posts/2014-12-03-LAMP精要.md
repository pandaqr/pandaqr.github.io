---     
layout: post     
title:  "LAMP精要"     
date:   2014-12-03 21:49:00     
categories: 前端     
---     

lamp是指：linux, apache, mysql, php。在mac上使用lamp与linux相差无几，作笔记如下：     
mac安装教程：         
http://www.guomii.com/posts/30136     

ubuntu的官方教程：     
http://wiki.ubuntu.org.cn/Apache#.E5.AE.89.E8.A3.85LAMP     

ubuntu快速指南：    
安装 `sudo apt-get install apache2 php5-mysql libapache2-mod-php5 mysql-server`    
配置：（默认php功能已经开启）    
  1>apache 的配置文件路径 /etc/apache2/apache2.conf    
  2>apache 网站字符编码配置路径 /etc/apache2/conf-enabled/charset.conf    
  3>php.ini 路径 /etc/php5/apache2/php.ini    
  4>mysql配置文件路径 /etc/mysql/my.cnf     
  5>phpmyadmin配置文件路径 /etc/phpmyadmin/apache.conf    
  6>默认网站根目录 ar/www/html        
使用：sudo sercice apache2/mysql start/stop        


## MySQL     

{% highlight sql %}     

开启服务     
mysql.server start              
                        //ubuntu命令：sudo service mysql start     

连接服务器     
mysql -uroot -p    

查看当前服务器和数据库的设置     
show variables 【注】由于结果比较多，可加like "xxx%"进行筛选     

查看所有数据库：     
show databases;     

创建数据库     
create database db_name;     
【注】数据库名称遇到中文或者特殊符号时，需要用反引号包裹，如：\`中文名字\`     

查看数据库的创建信息     
show create database db_name;     
【注】show数据的时候如果数据太多显示混乱，可用`\G`替代分号，如：`show create database db_name \G `     

删除数据库     
drop database db_name;     

设置操作的默认目标数据库     
use db_name;     

创建表     
create table table_name  (field field_type, …) [可选属性]     
【注】如果未指明当前默认数据库，需要在`table_name`前面手动指明对应数据库，即`db_name.table_name`     

查看表结构     
describe table_name;     

插入数据     
insert into table_name (field1, field2) values (value1, value2);     
【注】如果插入所有字段的值，那么可以省略字段列表的那个括号，但是记得值得顺序要与数据库一致。    
例如：insert into table_name values (value1, value2);     

删除数据     
delete from table_name where your_condition     
【注】where后面的条件写为数字1时，表示删除全表数据，但是表还在。     

修改数据     
update table_name set field1=value1 field2=value2 ... where your_condition     
updata table_name set field1 = field1 + 1  //这个字段自增1     

查询表数据     
select * from table_name;    //查看所有数据     
select * from table_name where your_condition  //有条件查询     
select field_name from table_name;  //只查看某些字段     
select count(field_name) from table_name   //查询表行数     
select * from table_name limit a, b     //a为起始行(from 0)，b为数量     
select * from table_name order by field_name desc limit 10   //逆序显示最新10条记录     

为表增加字段     
alter table table_name add field_name field_type;     

修改字段     
alter table table_name change old_field_name new_field_name new_field_type;     

查看表结构     
desc table_name;

显示表的创建信息
show create table_name; 
注意：如果把最后的分号；改成`\G`，则以图形化界面显示，可以显示大量的数据，容易阅读


校对规则
数据库管理系统在对数据进行排序时，是否大小写敏感之类的。
对于每一种字符集，都有若干种对应的校对规则。
如果希望对中文进行拼音排序，只有gbk这种中文字体具备识别拼音的校对规则，utf8没有哦~


varchar为什么最大长度为65532而不是65535?
可变长度，需要有两个字节来记录本字符串的长度（如果长度小于255则只需要一个字节）
另外，还需要一个字节来表示本字符串是否是null
所以有3个字节用不了的。
注意：varchar括号里面的数字，指的是`字符数`，而不是`字节数`，即如果是utf8的情况，括号里面写的最大的值就是65532的一半哦~


主键
能唯一标示一个记录就行，可以是一个字段，也可以是多个字段
主键最好不要有业务逻辑意义


外键
相当于字段的引用，常用于`从属关系`的实体。相对于自己手动操作，数据库提供的外键可以提供原子性和统一性。比如：一个人的记录被删除了，那么属于这个人的物品的记录，也应该被全部删除。
语法：
在定义`子表`时，放最后：
`foreign key (field_name_1) references father_table_name (field_name_2) on delete cascade`
其中：on delete可以改为on update， cascade可以改为 set null等
cascade代表级联操作（连带操作），即对父表中该实体操作时，自动关联这个子表的实体。

---------------------------------------     

//常见错误     
sudo mysql.server start时，出现以下错误：     
. ERROR! The server quit without updating PID file (/usr/local/var/mysql/LuRockdeAir.lan.pid).     
解决方案一：     
删除mysql配置文件，删除所有数据库（记得备份），卸载重装mysql即可     

方案二：     
把这个文件夹权限提高     
sudo chmod -R 777 /usr/local/var/mysql      

再不行：     
/usr/local/var/ 文件夹下有XX.err文件，错误日志     

---------------------------------------     


\s 显示目前信息     

数据库文件夹路径     
/usr/local/var/mysql/      

配置文件位置：（homebrew）     
/usr/local/Cellar/mysql/     

----------------------------------------     

数据库导出     
//in terminal     
mysqldump -uroot -p db_name > db_name.sql     

数据库导入     
//方法一：in mysql     
create database db_name;     
use db_name;     
source sqlFile_path;     

//方法二：in terminal     
mysql -uroot -p db_name < sqlFile_path     

[注意]如果导入时遇到“unknow command \x”，100%是字符集的问题     
[解决方案](in terminal)     
导出和导入时，都加上参数 --default-character-set=utf8     


----------------------------------------     
所有乱码的事情都是字符集的问题     

查看字符集     
show variables like 'character_set_%';     

默认字符集设置：my.cnf     
［client]在下面加入    
default-character-set=utf8    
[mysqld]下加入    
character-set-server=utf8    
collation-server=utf8_general_ci    

如果中文在client中文，在server乱码，或者相反，应该是连接的字符集问题：     
在PHP中，记得加入：`mysql_set_charset('utf8',$link);`     


---------------------     
ubuntu下删除mysql     

sudo apt-get autoremove --purge mysql-server-5.0     
sudo apt-get remove mysql-server     
sudo apt-get autoremove mysql-server     
sudo apt-get remove mysql-common      
dpkg -l |grep ^rc|awk '{print $2}' |sudo xargs dpkg -P     




{% endhighlight %}     

---      

---     


## PHP     

##### Key Point     
- 动态类型     
- 弱类型     
- 底层由c编写     
- 解释运行     
- 由解释器运行后，嵌入html代码     
- 区分大小写     



字符串拼接 => `.`（英文句号）     

##### 变量的作用域     
函数中，要使用全局变量，需做该变量的global声明；     

##### 单引号和双引号     
类似于ruby，单引号无视字符串内容，双引号会判别`变量`和`转义字符`     

##### 数组     
数组就是字典{map}，语法形式于ruby雷同     

##### heredoc语法     
功能：用于赋值一整段文本    
注意：还可以应用变量进行插值，主要是对于转义字符的处理比较方便     
语法：以`<<< 开始标记`开始，以`开始标记`结束     
```     
接收变量 =  <<<  开始标记     
这里是正文     
正文     
正文     
开始标记     
```     

##### 布尔值     
- 不区分大小写        
- 非0即为真（于c相同）     


print_r(数组名)可以直接打印输出数组各个元素     

##### `===`和`==`     
于js类似，==的相等，可以通过隐式类型转化，而===却表示完全相同，连类型也是一样     

##### 循环     
基本和c一致，但是多一个`foreach(arrayName as  itemName)`     
对于字典：`foreach(arrayName as keyName => valueName)`     


##### 函数     
- 定义可以写在文件的最后     
- 语法：     
```     
function nameOfFunction($nameOfArray) {     
    //body     
    return $returnValue;     
}     
```     


##### 文件包含     
类似于c语言的include，即把目标文件的文本，直接复制到当前位置。     

- require ‘文件路径’   —— 引用文件，失败则报错     
- include ‘文件路径’   —— 引用文件，失败时继续执行脚本     


##### 字符串拆分     
explode()函数     

---     

##### 页面跳转     
header(‘location: xxx.php”)    //支持相对路径 //不需要加http://     

##### post和get     
可用超全局数组`$_POST["post_name"]`、`$_GET["get_name"]`来获取     
[另]`$_REQUIRE["item"]`可以兼容post和get     
[注]必须全都大写     


##### 关于cookie     
读取：超全局数组`$_COOKIE["item_name"]`     
写入：`setcookie("item_name", $value, invalid_until/sec)`推荐时间写法：`time()+3600*24*30`意思是一个月     

##### 调试利器
调试请用`var_dump`输出，啥类型都能输出。表啥都echo。     

---     

##### 与MySQL的接口     
{% highlight php %}     
<?php     
// Connecting, selecting database     
$link = mysql_connect('mysql_host', 'mysql_user', 'mysql_password')     
    or die('Could not connect: ' . mysql_error());     
echo 'Connected successfully';        
mysql_set_charset('utf8',$link);     
mysql_select_db('my_database') or die('Could not select database');     

// Performing SQL query     
$query = 'SELECT * FROM my_table';     
$result = mysql_query($query) or die('Query failed: ' . mysql_error());     

// Printing results in HTML     
echo "<table>\n";     
while ($line = mysql_fetch_array($result, MYSQL_ASSOC)) {     
    echo "\t<tr>\n";     
    foreach ($line as $col_value) {     
        echo "\t\t<td>$col_value</td>\n";     
    }     
    echo "\t</tr>\n";     
}     
echo "</table>\n";     

// Free resultset     
mysql_free_result($result);     

// Closing connection     
mysql_close($link);     
?>     
{% endhighlight %}     

---     

##### php调用c++程序     
使用PHP提供的`exec()函数`（貌似就是linux系统提供的那个？。。。）      
调用格式：`exec("cppFilePath arguments", $outputArgument);`     

前提：必须是已经编译过的可执行二进制文件哦～     
输入方式：命令行参数     
输出方式：在cpp中`标准输出`，以`回车`分割元素     
返回结果：用php中的`$outputArgument`，格式为`字符串类型的数组`        

【另外】不知道为什么，好像只有在同一文件夹才能调用。。。     

参考：     
[http://stackoverflow.com/questions/11789095/run-c-script-in-php](http://stackoverflow.com/questions/11789095/run-c-script-in-php)     


范例：     
{% highlight php %}     

<?php     
    exec("/Library/WebServer/Documents/hello 爱的我中华", $output);     
    print_r($output);     
?>     

{% endhighlight %}     

---     

##### php的配置文件     
/etc/php.ini.default  里面开启各项配置（`;`号为注释符）     

---      

##### 经典错误：header is already sent之类的     
意思是http头文件已经写好发送了，再改来不及了     
[解决方案]增加缓存，不要急着写入http     
方法一：     
在php文件最前面加：`ob_start();`     
在最后加：`ob_end_flush();`     

方法二：     
修改php的配置：`set output_buffering = On`     

[注]这两个方法原理相同，会降低php的执行效率     

---     



## apache     

配置目录：     
/etc/apache2    

主要配置文件：     
httpd.conf      
                    //在ubuntu下似乎有所不同，是apache2.conf     

默认根目录：     
/Library/WebServer/Documents/     
[注]网页放在这里就可以用localhost地址访问到，但是这个文件夹是有root权限的，建议chmod777一下。。。    
                    //ubuntu位置：/var/www/html/     

##### 常用命令：     
apachectl start/stop/restart     
apachectl -v     
                    //ubuntu命令：sudo service apache2 strat/stop....     
netstate -an     

127.0.0.1 回送地址     



##### 开通php功能：     
在httpd.conf中，用关键字`php`搜索到：     
`LoadModule php5_module libexec/apache2/libphp5.so`     
然后把这句话前面的`#`号去掉即可     

测试：     
<?php phpinfo(); ?>     


##### 注意     
Apache这哥们儿反应比较慢，可能会有1分钟左右的延迟     



##### httpd.conf文件中的访问权限设置     
<Directory "/Users/username/Sites/">        //指明目录     

//这种是默认的设置     
Order allow,deny        //order代表读取下面两个设置的的顺序（先读allow，再度deny）     
Allow from all          //代表允许从任何ip来的请求     

//实际上是这样的设置     
Order deny, allow     
deny from 127.0     
allow form 127.0.0.223      //这两句代表拒绝除127.0.0.223之外的所有127.0开头的ip     

//注：如果换allow和deny的顺序，那么就是拒绝所有127.0开头的ip，那个233也拒绝     
</Directory>     




 




